import{j as e,T as c,r as x,aj as ce,ak as ae,S as l,f as S,a4 as de,t as he,B as w,aJ as _,aK as Z,aL as ee,aM as pe,aN as Ee,aB as xe,D as ge,E as me,aO as je,m as Ce}from"./vendor-mui-DDhzcgPb.js";import{q as W,f as ve,g as be,h as fe,i as ye,j as Se}from"./type-f6INFkbl.js";import{K as se,B as j,N as Ae,v as te,d as ie,u as re,t as ue,F as De,M as ke,S as D,C as V,w as Fe,E as Le,j as Te,k as Me,O as Be,y as ne,n as m,P as oe,U as I,Q as Pe}from"./index-BnGCAzKI.js";import{c as K,u as Q}from"./vendor-utils-BRiujrGV.js";import{N as Ne}from"./index-COobKTZ7.js";import{b as le,u as Ue}from"./vendor-router-B6q9Nvgf.js";class we{constructor(n){this.lessonCreate=(t,a={})=>this.http.request({path:"/lessons/",method:"POST",body:t,secure:!0,type:se.FormData,format:"json",...a}),this.lessonUpdate=(t,a,u={})=>this.http.request({path:`/lessons/${t}`,method:"PUT",body:a,secure:!0,type:se.FormData,format:"json",...u}),this.lessonDelete=(t,a={})=>this.http.request({path:`/lessons/${t}`,method:"DELETE",secure:!0,...a}),this.http=n}}const R=new we(Ae),Ie=()=>{const i=K();return Q({mutationFn:n=>R.lessonCreate(n),onSuccess(){j.success("Create lesson successful"),i.invalidateQueries({queryKey:[W.getCourse]})},onError(n){j.error(n.error)}})},qe=()=>{const i=K();return Q({mutationFn:({id:n,data:t})=>R.lessonUpdate(n,t),onSuccess(){j.success("Update lesson successful"),i.invalidateQueries({queryKey:[W.getCourse]})},onError(n){j.error(n.error)}})},Oe=()=>{const i=K();return Q({mutationFn:n=>R.lessonDelete(n),onSuccess(n){j.success(n.message),i.invalidateQueries({queryKey:[W.getCourse]})},onError(n){j.error(n.error)}})},Ve=({open:i,onClose:n})=>e.jsxs(te,{title:"Chuyển khoản",open:i,onClose:n,children:[e.jsx("img",{src:"/payment_qr.jpg"}),"Nội dung chuyển khoản:",e.jsx(c,{fontWeight:"bold",children:"Tên khoá học - Email đăng nhập"}),e.jsx(c,{color:"textSecondary",children:"Ví dụ: Giải đề thi THPT Quốc gia bằng máy tính Casio - nguyenvana@gmail.com"}),e.jsx(c,{fontWeight:"bold",children:"Khoá học sẽ được kích hoạt trong vòng 24h kể từ khi chuyển khoản."})]}),We=({length:i,open:n,onClose:t})=>{var P,N,U;const{id:a}=le(),{selectedLesson:u}=ie(),[k,C]=x.useState(),F=re({resolver:ue(u.id?ve:be),values:{title:u.title,position:u.id?String(u.position):String(i+1),video:void 0}}),{register:v,handleSubmit:q,setValue:b,watch:O,reset:L,clearErrors:T,setError:f,formState:{errors:A}}=F,y=O("position"),s=Ie(),M=qe(),B=q(r=>{if(u.id){M.mutate({id:u.id,data:{title:r.title,video:r!=null&&r.video?r.video:void 0,position:Number(r.position)}},{onSuccess(){h()}});return}r.video&&s.mutate({courseId:Number(a)||0,title:r.title,video:r.video,position:Number(r.position)},{onSuccess(){h()}})}),h=()=>{L(),C(null),t==null||t()};return x.useEffect(()=>{if(T("position"),Number(y)<1){f("position",{message:"Vị trí bài học không hợp lệ"});return}if(u.id&&Number(y)>i){f("position",{message:"Vị trí bài học vượt quá số bài hiện tại"});return}if(Number(y)>i+1){f("position",{message:"Vị trí bài học vượt quá số bài hiện tại"});return}},[y,u,i,f,T]),e.jsx(De,{...F,children:e.jsx(ce,{open:n,onClose:h,children:e.jsx(ke,{children:e.jsxs("form",{onSubmit:B,children:[e.jsxs(D,{children:[e.jsx(c,{variant:"h6",children:"Đăng tải tài liệu"}),e.jsx(ae,{onClick:h,sx:{cursor:"pointer"}})]}),e.jsxs(l,{flexDirection:"column",gap:4,marginY:2,children:[e.jsx(V,{label:"Tên bài học",registerProps:v("title"),errorMsg:(P=A.title)==null?void 0:P.message}),e.jsx(V,{label:"Bài học số",registerProps:v("position"),errorMsg:(N=A.position)==null?void 0:N.message}),e.jsxs(l,{flexDirection:"column",children:[e.jsx(Fe,{children:"Video bài giảng"}),e.jsxs(S,{variant:"outlined",component:"label",sx:{textTransform:"none"},children:["Chọn file từ máy tính",e.jsx("input",{hidden:!0,accept:"video/mp4,video/avi,video/mov",type:"file",onChange:r=>{const d=r.target.files,p=((d==null?void 0:d.length)||0)>0?d==null?void 0:d[0]:void 0;b("video",p,{shouldValidate:!0}),b("title",p?p.name.split(".")[0]:"",{shouldValidate:!0}),C((p==null?void 0:p.name)||null)}})]}),k&&e.jsx(c,{variant:"body2",color:"text.secondary",sx:{marginTop:1},children:k}),e.jsx(Le,{message:(U=A.video)==null?void 0:U.message})]})]}),e.jsxs(Te,{marginTop:4,gap:2,children:[e.jsx(S,{onClick:h,children:"Huỷ bỏ"}),e.jsx(S,{variant:"contained",type:"submit",disabled:s.isPending||M.isPending,onClick:B,children:"Lưu"})]})]})})})})},$e=()=>{var H,G,$,z,J,X;const i=Ue(),{id:n}=le(),{user:t,getUser:a}=Me(),{setSelectedLesson:u}=ie(),[k,C]=x.useState(!1),[F,v]=x.useState(!1),[q,b]=x.useState(!1),[O,L]=x.useState(0),{register:T,handleSubmit:f,reset:A,formState:{errors:y}}=re({resolver:ue(Se),values:{email:""}}),{data:s}=fe(Number(n)||0),[M,B]=x.useState(Array((H=s==null?void 0:s.lessons)==null?void 0:H.length).fill(!1)),h=((G=s==null?void 0:s.lessons)==null?void 0:G.reduce((o,E)=>o+E.duration,0))||0,P=o=>{B(E=>{const g=[...E];return g[o]=!g[o],g})},{mutate:N}=Oe(),{mutate:U}=ye(),r=o=>{N(o,{onSuccess(){v(!1)}})},d=f(o=>{console.log("formData",o),U({email:o.email,courseId:Number(n)},{onSuccess(){A()}})}),p=de(),Y=he(p.breakpoints.down("sm"));return x.useEffect(()=>{a().id||(j.warn("Bạn cần đăng nhập để xem chi tiết"),i("/login"))},[t,i,a]),e.jsxs(l,{marginTop:5,gap:10,children:[e.jsxs(l,{flexDirection:"column",gap:4,width:{xs:"100%",md:"70%"},children:[e.jsxs(l,{gap:{xs:2,md:5},children:[e.jsxs(w,{width:{xs:"60%",md:"100%"},children:[e.jsx(c,{variant:Y?"h6":"h5",fontWeight:"bold",children:s==null?void 0:s.title}),e.jsx(Be,{lines:10,children:s==null?void 0:s.description}),e.jsxs(l,{gap:2,children:["Được tạo bởi:",e.jsx(c,{fontWeight:"bold",children:s==null?void 0:s.instructor})]})]}),e.jsxs(l,{flexDirection:"column",width:"40%",display:{xs:"block",md:"none"},children:[e.jsx(ne,{src:s==null?void 0:s.thumbnailUrl,alt:"Ảnh bìa"}),e.jsxs(l,{flexDirection:"column",gap:1,sx:{marginY:2},children:[e.jsxs(m,{gap:2,children:[e.jsx(_,{})," ",oe(h)," giờ video theo yêu cầu"]}),e.jsxs(m,{gap:2,children:[e.jsx(Z,{})," Truy cập trên di động và TV"]}),e.jsxs(m,{gap:2,children:[e.jsx(ee,{})," Chứng chỉ hoàn thành"]})]}),t.role===I.RoleAdmin?e.jsxs(m,{gap:2,children:[e.jsx(V,{label:"User email",showLabel:!1,registerProps:T("email"),errorMsg:($=y.email)==null?void 0:$.message}),e.jsx(pe,{fontSize:"medium",sx:{cursor:"pointer"},onClick:d})]}):e.jsx(e.Fragment,{children:!(s!=null&&s.isActive)&&e.jsxs(D,{children:[e.jsx(c,{variant:"h6",fontWeight:"bold",children:s==null?void 0:s.price.toLocaleString()}),e.jsx(Ee,{onClick:()=>b(!0),sx:{cursor:"pointer"}})]})})]})]}),e.jsx(xe,{sx:{paddingY:3}}),e.jsxs(D,{children:[e.jsx(c,{variant:Y?"h6":"h5",fontWeight:"bold",children:"Nội dung khoá học"}),e.jsx(S,{variant:"contained",onClick:()=>C(!0),children:"Thêm bài học"})]}),e.jsxs(w,{children:[(z=s==null?void 0:s.lessons)==null?void 0:z.map((o,E)=>e.jsxs(w,{padding:2,sx:{border:"1px solid #ddd",marginBottom:1},children:[e.jsxs(D,{children:[e.jsxs(c,{fontWeight:"bold",sx:{cursor:"pointer"},onClick:()=>P(E),children:["Bài số ",E+1,": ",o==null?void 0:o.title]}),e.jsxs(l,{paddingX:2,gap:2,children:[t.role===I.RoleAdmin&&e.jsx(ge,{sx:{cursor:"pointer"},onClick:g=>{g.stopPropagation(),L(o.id),v(!0)}}),t.role===I.RoleAdmin&&e.jsx(me,{sx:{cursor:"pointer"},onClick:g=>{g.stopPropagation(),u(o),C(!0),L(o.id)}}),e.jsx(c,{fontWeight:"bold",children:Pe(o.duration)})]})]}),e.jsx(je,{in:M[E],children:e.jsx(w,{sx:{padding:2},children:s.isActive?e.jsxs("video",{controls:!0,width:"100%",children:[e.jsx("source",{src:o.videoUrl,type:"video/mp4"}),"Trình duyệt của bạn không hỗ trợ video."]}):e.jsx(e.Fragment,{children:"Bạn cần đăng ký khoá học"})})})]},E)),e.jsx(Ne,{length:((J=s==null?void 0:s.lessons)==null?void 0:J.length)||0})]})]}),e.jsxs(l,{flexDirection:"column",width:"30%",display:{xs:"none",md:"block"},children:[e.jsx(ne,{src:s==null?void 0:s.thumbnailUrl,alt:"Ảnh bìa"}),e.jsxs(l,{flexDirection:"column",gap:2,sx:{marginY:4},children:[e.jsxs(m,{gap:2,children:[e.jsx(_,{})," ",oe(h)," giờ video theo yêu cầu"]}),e.jsxs(m,{gap:2,children:[e.jsx(Z,{})," Truy cập trên di động và TV"]}),e.jsxs(m,{gap:2,children:[e.jsx(ee,{})," Chứng chỉ hoàn thành"]})]}),t.role===I.RoleAdmin?e.jsxs(l,{alignItems:"end",gap:2,children:[e.jsx(Ce,{placeholder:"User email"}),e.jsx(S,{variant:"contained",sx:{width:120,height:35},onClick:d,children:"Kích hoạt"})]}):e.jsx(e.Fragment,{children:!(s!=null&&s.isActive)&&e.jsxs(D,{children:[e.jsx(c,{variant:"h6",fontWeight:"bold",children:s==null?void 0:s.price.toLocaleString()}),e.jsx(S,{variant:"contained",onClick:()=>b(!0),children:"Mua ngay"})]})})]}),e.jsx(We,{length:((X=s==null?void 0:s.lessons)==null?void 0:X.length)||0,open:k,onClose:()=>{u({}),C(!1)}}),e.jsx(te,{open:F,onClose:()=>v(!1),content:"Bạn có chắc chắn muốn xoá nó không?",onSubmit:()=>r(O)}),e.jsx(Ve,{open:q,onClose:()=>b(!1)})]})};export{$e as default};
