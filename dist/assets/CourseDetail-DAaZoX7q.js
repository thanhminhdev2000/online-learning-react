import{l as be,m as Ae,s as se,a3 as we,r as x,n as Fe,X as me,al as Te,Y as Me,j as e,o as Le,p as ke,am as ze,a0 as Pe,a2 as ae,q as _,an as le,ao as ne,ap as te,h as N,aq as Ie,T as m,i as xe,v as ge,M as Re,y as Ue,z as Q,S as p,R as We,c as O,F as Ne,u as Ve,a as Be,B as X,O as He,W as ue,G as W,ar as ce,J,as as qe,at as $e,au as Oe}from"./index-BnQnY9EU.js";import{q as oe,f as Ke,g as Qe,h as Ye,i as Ge,j as Xe}from"./type-D76zXet1.js";import{a as Ee,C as Je}from"./index-n6AzoaaD.js";import{u as je,t as fe,F as _e,C as Z,E as Ze,T as es}from"./index-DBvPQqYV.js";import{N as ss}from"./index-BM94K5iA.js";import{S as ns}from"./Send-Dz5IrRr2.js";import{u as ts}from"./useMediaQuery-C0wS3aJw.js";import{D as os}from"./Divider-BqO99Bgx.js";function is(o){return Ae("MuiCollapse",o)}be("MuiCollapse",["root","horizontal","vertical","entered","hidden","wrapper","wrapperInner"]);const rs=o=>{const{orientation:n,classes:i}=o,l={root:["root",`${n}`],entered:["entered"],hidden:["hidden"],wrapper:["wrapper",`${n}`],wrapperInner:["wrapperInner",`${n}`]};return ke(l,is,i)},as=se("div",{name:"MuiCollapse",slot:"Root",overridesResolver:(o,n)=>{const{ownerState:i}=o;return[n.root,n[i.orientation],i.state==="entered"&&n.entered,i.state==="exited"&&!i.in&&i.collapsedSize==="0px"&&n.hidden]}})(we(({theme:o})=>({height:0,overflow:"hidden",transition:o.transitions.create("height"),variants:[{props:{orientation:"horizontal"},style:{height:"auto",width:0,transition:o.transitions.create("width")}},{props:{state:"entered"},style:{height:"auto",overflow:"visible"}},{props:{state:"entered",orientation:"horizontal"},style:{width:"auto"}},{props:({ownerState:n})=>n.state==="exited"&&!n.in&&n.collapsedSize==="0px",style:{visibility:"hidden"}}]}))),ls=se("div",{name:"MuiCollapse",slot:"Wrapper",overridesResolver:(o,n)=>n.wrapper})({display:"flex",width:"100%",variants:[{props:{orientation:"horizontal"},style:{width:"auto",height:"100%"}}]}),us=se("div",{name:"MuiCollapse",slot:"WrapperInner",overridesResolver:(o,n)=>n.wrapperInner})({width:"100%",variants:[{props:{orientation:"horizontal"},style:{width:"auto",height:"100%"}}]}),ee=x.forwardRef(function(n,i){const l=Fe({props:n,name:"MuiCollapse"}),{addEndListener:a,children:V,className:T,collapsedSize:f="0px",component:v,easing:B,in:C,onEnter:H,onEntered:z,onEntering:P,onExit:y,onExited:I,onExiting:S,orientation:s="vertical",style:M,timeout:c=ze.standard,TransitionComponent:g=Pe,...q}=l,D={...l,orientation:s,collapsedSize:f},E=rs(D),u=me(),b=Te(),d=x.useRef(null),$=x.useRef(),R=typeof f=="number"?`${f}px`:f,L=s==="horizontal",k=L?"width":"height",U=x.useRef(null),Y=Me(i,U),A=t=>h=>{if(t){const F=U.current;h===void 0?t(F):t(F,h)}},r=()=>d.current?d.current[L?"clientWidth":"clientHeight"]:0,j=A((t,h)=>{d.current&&L&&(d.current.style.position="absolute"),t.style[k]=R,H&&H(t,h)}),w=A((t,h)=>{const F=r();d.current&&L&&(d.current.style.position="");const{duration:K,easing:G}=ae({style:M,timeout:c,easing:B},{mode:"enter"});if(c==="auto"){const re=u.transitions.getAutoHeightDuration(F);t.style.transitionDuration=`${re}ms`,$.current=re}else t.style.transitionDuration=typeof K=="string"?K:`${K}ms`;t.style[k]=`${F}px`,t.style.transitionTimingFunction=G,P&&P(t,h)}),ve=A((t,h)=>{t.style[k]="auto",z&&z(t,h)}),Ce=A(t=>{t.style[k]=`${r()}px`,y&&y(t)}),ye=A(I),Se=A(t=>{const h=r(),{duration:F,easing:K}=ae({style:M,timeout:c,easing:B},{mode:"exit"});if(c==="auto"){const G=u.transitions.getAutoHeightDuration(h);t.style.transitionDuration=`${G}ms`,$.current=G}else t.style.transitionDuration=typeof F=="string"?F:`${F}ms`;t.style[k]=R,t.style.transitionTimingFunction=K,S&&S(t)}),De=t=>{c==="auto"&&b.start($.current||0,t),a&&a(U.current,t)};return e.jsx(g,{in:C,onEnter:j,onEntered:ve,onEntering:w,onExit:Ce,onExited:ye,onExiting:Se,addEndListener:De,nodeRef:U,timeout:c==="auto"?null:c,...q,children:(t,h)=>e.jsx(as,{as:v,className:Le(E.root,T,{entered:E.entered,exited:!C&&R==="0px"&&E.hidden}[t]),style:{[L?"minWidth":"minHeight"]:R,...M},ref:Y,...h,ownerState:{...D,state:t},children:e.jsx(ls,{ownerState:{...D,state:t},className:E.wrapper,ref:d,children:e.jsx(us,{ownerState:{...D,state:t},className:E.wrapperInner,children:V})})})})});ee&&(ee.muiSupportAuto=!0);const cs=_(e.jsx("path",{d:"M11 9h2V6h3V4h-3V1h-2v3H8v2h3zm-4 9c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2m10 0c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2m-9.83-3.25.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.86-7.01L19.42 4h-.01l-1.1 2-2.76 5H8.53l-.13-.27L6.16 6l-.95-2-.94-2H1v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.13 0-.25-.11-.25-.25"}),"AddShoppingCart"),de=_(e.jsx("path",{d:"M21 3H3c-1.11 0-2 .89-2 2v12c0 1.1.89 2 2 2h5v2h8v-2h5c1.1 0 1.99-.9 1.99-2L23 5c0-1.11-.9-2-2-2m0 14H3V5h18zm-5-6-7 4V7z"}),"OndemandVideo"),he=_(e.jsx("path",{d:"M16 1H8C6.34 1 5 2.34 5 4v16c0 1.66 1.34 3 3 3h8c1.66 0 3-1.34 3-3V4c0-1.66-1.34-3-3-3m-2 20h-4v-1h4zm3.25-3H6.75V4h10.5z"}),"PhoneAndroid"),pe=_(e.jsx("path",{d:"M9.68 13.69 12 11.93l2.31 1.76-.88-2.85L15.75 9h-2.84L12 6.19 11.09 9H8.25l2.31 1.84zM20 10c0-4.42-3.58-8-8-8s-8 3.58-8 8c0 2.03.76 3.87 2 5.28V23l6-2 6 2v-7.72c1.24-1.41 2-3.25 2-5.28m-8-6c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6 2.69-6 6-6"}),"WorkspacePremium");class ds{constructor(n){this.lessonCreate=(i,l={})=>this.http.request({path:"/lessons/",method:"POST",body:i,secure:!0,type:le.FormData,format:"json",...l}),this.lessonUpdate=(i,l,a={})=>this.http.request({path:`/lessons/${i}`,method:"PUT",body:l,secure:!0,type:le.FormData,format:"json",...a}),this.lessonDelete=(i,l={})=>this.http.request({path:`/lessons/${i}`,method:"DELETE",secure:!0,...l}),this.http=n}}const ie=new ds(Ie),hs=()=>{const o=ne();return te({mutationFn:n=>ie.lessonCreate(n),onSuccess(){N.success("Create lesson successful"),o.invalidateQueries({queryKey:[oe.getCourse]})},onError(n){N.error(n.error)}})},ps=()=>{const o=ne();return te({mutationFn:({id:n,data:i})=>ie.lessonUpdate(n,i),onSuccess(){N.success("Update lesson successful"),o.invalidateQueries({queryKey:[oe.getCourse]})},onError(n){N.error(n.error)}})},ms=()=>{const o=ne();return te({mutationFn:n=>ie.lessonDelete(n),onSuccess(n){N.success(n.message),o.invalidateQueries({queryKey:[oe.getCourse]})},onError(n){N.error(n.error)}})},xs=({open:o,onClose:n})=>e.jsxs(Ee,{title:"Chuyển khoản",open:o,onClose:n,children:[e.jsx("img",{src:"/payment_qr.jpg"}),"Nội dung chuyển khoản:",e.jsx(m,{fontWeight:"bold",children:"Tên khoá học - Email đăng nhập"}),e.jsx(m,{color:"textSecondary",children:"Ví dụ: Giải đề thi THPT Quốc gia bằng máy tính Casio - nguyenvana@gmail.com"}),e.jsx(m,{fontWeight:"bold",children:"Khoá học sẽ được kích hoạt trong vòng 24h kể từ khi chuyển khoản."})]}),gs=({length:o,open:n,onClose:i})=>{var q,D,E;const{id:l}=xe(),{selectedLesson:a}=ge(),[V,T]=x.useState(),f=je({resolver:fe(a.id?Ke:Qe),values:{title:a.title,position:a.id?String(a.position):String(o+1),video:void 0}}),{register:v,handleSubmit:B,setValue:C,watch:H,reset:z,clearErrors:P,setError:y,formState:{errors:I}}=f,S=H("position"),s=hs(),M=ps(),c=B(u=>{if(u.video){if(a.id){M.mutate({id:a.id,data:{title:u.title,video:u.video,position:Number(u.position)}},{onSuccess(){g()}});return}s.mutate({courseId:Number(l)||0,title:u.title,video:u.video,position:Number(u.position)},{onSuccess(){g()}})}}),g=()=>{z(),T(null),i==null||i()};return x.useEffect(()=>{if(P("position"),Number(S)<1){y("position",{message:"Vị trí bài học không hợp lệ"});return}if(a.id&&Number(S)>o){y("position",{message:"Vị trí bài học vượt quá số bài hiện tại"});return}if(Number(S)>o+1){y("position",{message:"Vị trí bài học vượt quá số bài hiện tại"});return}},[S,a,o,y,P]),e.jsx(_e,{...f,children:e.jsx(Re,{open:n,onClose:g,children:e.jsx(Ue,{children:e.jsxs("form",{onSubmit:c,children:[e.jsxs(Q,{children:[e.jsx(m,{variant:"h6",children:"Đăng tải tài liệu"}),e.jsx(Je,{onClick:g,sx:{cursor:"pointer"}})]}),e.jsxs(p,{flexDirection:"column",gap:4,marginY:2,children:[e.jsx(Z,{label:"Tên bài học",registerProps:v("title"),errorMsg:(q=I.title)==null?void 0:q.message}),e.jsx(Z,{label:"Bài học số",registerProps:v("position"),errorMsg:(D=I.position)==null?void 0:D.message}),e.jsxs(p,{flexDirection:"column",children:[e.jsx(We,{children:"Video bài giảng"}),e.jsxs(O,{variant:"outlined",component:"label",sx:{textTransform:"none"},children:["Chọn file từ máy tính",e.jsx("input",{hidden:!0,accept:"video/mp4,video/avi,video/mov",type:"file",...v("video",{onChange:u=>{var d;const b=((d=u.target.files)==null?void 0:d[0])||null;C("video",b,{shouldValidate:!0}),C("title",b?b.name.split(".")[0]:""),T(b.name)}})})]}),V&&e.jsx(m,{variant:"body2",color:"text.secondary",sx:{marginTop:1},children:V}),e.jsx(Ze,{message:(E=I.video)==null?void 0:E.message})]})]}),e.jsxs(Ne,{marginTop:4,gap:2,children:[e.jsx(O,{onClick:g,children:"Huỷ bỏ"}),e.jsx(O,{variant:"contained",type:"submit",disabled:s.isPending||M.isPending,onClick:c,children:"Lưu"})]})]})})})})},bs=()=>{var R,L,k,U,Y,A;const o=Ve(),{id:n}=xe(),{user:i,getUser:l}=Be(),{setSelectedLesson:a}=ge(),[V,T]=x.useState(!1),[f,v]=x.useState(!1),[B,C]=x.useState(!1),[H,z]=x.useState(0),{register:P,handleSubmit:y,reset:I,formState:{errors:S}}=je({resolver:fe(Xe),values:{email:""}}),{data:s}=Ye(Number(n)||0),[M,c]=x.useState(Array((R=s==null?void 0:s.lessons)==null?void 0:R.length).fill(!1)),g=((L=s==null?void 0:s.lessons)==null?void 0:L.reduce((r,j)=>r+j.duration,0))||0,q=r=>{c(j=>{const w=[...j];return w[r]=!w[r],w})},{mutate:D}=ms(),{mutate:E}=Ge(),u=r=>{D(r,{onSuccess(){v(!1)}})},b=y(r=>{console.log("formData",r),E({email:r.email,courseId:Number(n)},{onSuccess(){I()}})}),d=me(),$=ts(d.breakpoints.down("sm"));return x.useEffect(()=>{l().id||(N.warn("Bạn cần đăng nhập để xem chi tiết"),o("/login"))},[i,o,l]),e.jsxs(p,{marginTop:5,gap:10,children:[e.jsxs(p,{flexDirection:"column",gap:4,width:{xs:"100%",md:"70%"},children:[e.jsxs(p,{gap:{xs:2,md:5},children:[e.jsxs(X,{width:{xs:"60%",md:"100%"},children:[e.jsx(m,{variant:$?"h6":"h5",fontWeight:"bold",children:s==null?void 0:s.title}),e.jsx(He,{lines:10,children:s==null?void 0:s.description}),e.jsxs(p,{gap:2,children:["Được tạo bởi:",e.jsx(m,{fontWeight:"bold",children:s==null?void 0:s.instructor})]})]}),e.jsxs(p,{flexDirection:"column",width:"40%",display:{xs:"block",md:"none"},children:[e.jsx(ue,{src:s==null?void 0:s.thumbnailUrl,alt:"Ảnh bìa"}),e.jsxs(p,{flexDirection:"column",gap:1,sx:{marginY:2},children:[e.jsxs(W,{gap:2,children:[e.jsx(de,{})," ",ce(g)," giờ video theo yêu cầu"]}),e.jsxs(W,{gap:2,children:[e.jsx(he,{})," Truy cập trên di động và TV"]}),e.jsxs(W,{gap:2,children:[e.jsx(pe,{})," Chứng chỉ hoàn thành"]})]}),i.role===J.RoleAdmin?e.jsxs(W,{gap:2,children:[e.jsx(Z,{label:"User email",showLabel:!1,registerProps:P("email"),errorMsg:(k=S.email)==null?void 0:k.message}),e.jsx(ns,{fontSize:"medium",sx:{cursor:"pointer"},onClick:b})]}):e.jsx(e.Fragment,{children:!(s!=null&&s.isActive)&&e.jsxs(Q,{children:[e.jsx(m,{variant:"h6",fontWeight:"bold",children:s==null?void 0:s.price.toLocaleString()}),e.jsx(cs,{onClick:()=>C(!0),sx:{cursor:"pointer"}})]})})]})]}),e.jsx(os,{sx:{paddingY:3}}),e.jsxs(Q,{children:[e.jsx(m,{variant:$?"h6":"h5",fontWeight:"bold",children:"Nội dung khoá học"}),e.jsx(O,{variant:"contained",onClick:()=>T(!0),children:"Thêm bài học"})]}),e.jsxs(X,{children:[(U=s==null?void 0:s.lessons)==null?void 0:U.map((r,j)=>e.jsxs(X,{padding:2,sx:{border:"1px solid #ddd",marginBottom:1},children:[e.jsxs(Q,{children:[e.jsxs(m,{fontWeight:"bold",sx:{cursor:"pointer"},onClick:()=>q(j),children:["Bài số ",j+1,": ",r==null?void 0:r.title]}),e.jsxs(p,{paddingX:2,gap:2,children:[i.role===J.RoleAdmin&&e.jsx(qe,{sx:{cursor:"pointer"},onClick:w=>{w.stopPropagation(),z(r.id),v(!0)}}),i.role===J.RoleAdmin&&e.jsx($e,{sx:{cursor:"pointer"},onClick:w=>{w.stopPropagation(),a(r),T(!0),z(r.id)}}),e.jsx(m,{fontWeight:"bold",children:Oe(r.duration)})]})]}),e.jsx(ee,{in:M[j],children:e.jsx(X,{sx:{padding:2},children:s.isActive?e.jsxs("video",{controls:!0,width:"100%",children:[e.jsx("source",{src:r.videoUrl,type:"video/mp4"}),"Trình duyệt của bạn không hỗ trợ video."]}):e.jsx(e.Fragment,{children:"Bạn cần đăng ký khoá học"})})})]},j)),e.jsx(ss,{length:((Y=s==null?void 0:s.lessons)==null?void 0:Y.length)||0})]})]}),e.jsxs(p,{flexDirection:"column",width:"30%",display:{xs:"none",md:"block"},children:[e.jsx(ue,{src:s==null?void 0:s.thumbnailUrl,alt:"Ảnh bìa"}),e.jsxs(p,{flexDirection:"column",gap:2,sx:{marginY:4},children:[e.jsxs(W,{gap:2,children:[e.jsx(de,{})," ",ce(g)," giờ video theo yêu cầu"]}),e.jsxs(W,{gap:2,children:[e.jsx(he,{})," Truy cập trên di động và TV"]}),e.jsxs(W,{gap:2,children:[e.jsx(pe,{})," Chứng chỉ hoàn thành"]})]}),i.role===J.RoleAdmin?e.jsxs(p,{alignItems:"end",gap:2,children:[e.jsx(es,{placeholder:"User email"}),e.jsx(O,{variant:"contained",sx:{width:120,height:35},onClick:b,children:"Kích hoạt"})]}):e.jsx(e.Fragment,{children:!(s!=null&&s.isActive)&&e.jsxs(Q,{children:[e.jsx(m,{variant:"h6",fontWeight:"bold",children:s==null?void 0:s.price.toLocaleString()}),e.jsx(O,{variant:"contained",onClick:()=>C(!0),children:"Mua ngay"})]})})]}),e.jsx(gs,{length:((A=s==null?void 0:s.lessons)==null?void 0:A.length)||0,open:V,onClose:()=>{a({}),T(!1)}}),e.jsx(Ee,{open:f,onClose:()=>v(!1),content:"Bạn có chắc chắn muốn xoá nó không?",onSubmit:()=>u(H)}),e.jsx(xs,{open:B,onClose:()=>C(!1)})]})};export{bs as default};
