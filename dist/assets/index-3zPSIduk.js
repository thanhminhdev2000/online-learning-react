import{r as c,j as e,aj as ne,T as E,ak as te,S as v,f as k,B as F,ax as ie,ay as oe,az as ae,aA as le,aB as re,aC as ce,aD as ue,aE as de}from"./vendor-mui-DDhzcgPb.js";import{z as r,e as M,d as H,u as J,t as pe,g as me,h as K,B as xe,F as he,M as je,S as Q,C as R,i as G,E as ge,j as be,k as Ee,l as fe,m as Ce,n as b,U,o as Se,p as Ie,O as N,q as De,D as Ae,s as ye,v as Fe}from"./index-BnGCAzKI.js";import{C as Me}from"./ClassMenu-BOt6unAO.js";import{N as ke}from"./index-COobKTZ7.js";import"./vendor-utils-BRiujrGV.js";import"./vendor-router-B6q9Nvgf.js";const Z=r.object({title:r.string().min(1,M("Tiêu đề")),classId:r.number().min(1,M("Tên lớp học")),subjectId:r.number().min(1,M("Tên môn học")),author:r.string(),file:r.any().refine(n=>n instanceof File&&n.size>0,M("File"))}),ve=Z.omit({file:!0}).merge(r.object({file:r.any().optional()})),Te=({refetch:n,open:f,onClose:x})=>{var L,V,W,_,X,Y;const T="https://online-learning-aws.s3.us-east-1.amazonaws.com/pdfs/",{classId:w,subjectId:P,classes:a,selectedDocument:t}=H(),u=(L=t.fileUrl)==null?void 0:L.split(T)[1],[C,m]=c.useState(u),S=J({resolver:pe(t.id?ve:Z),values:{title:t.title||"",classId:t.classId||w,subjectId:t.subjectId||P,author:t.author,file:void 0}}),{register:d,handleSubmit:I,watch:l,setValue:D,reset:B,formState:{errors:p}}=S,A=l("classId"),O=c.useMemo(()=>a.map(o=>({key:o.name,value:o.id})),[a]),s=c.useMemo(()=>{var g,q;return(q=((g=a.find(y=>y.id===A))==null?void 0:g.subjects)||[])==null?void 0:q.map(y=>({key:y.name,value:y.id}))},[A,a]),{mutate:h,isPending:$}=me(),{mutate:ee,isPending:se}=K(),z=I(i=>{if(i.file){if(t.id){ee({documentId:t.id,payload:{title:i.title,file:i.file,author:i.author}},{onSuccess(o){j(),n==null||n(),xe.success(o.message)}});return}h({title:i.title,subjectId:Number(i.subjectId),file:i.file,author:i.author},{onSuccess(){j(),n==null||n()}})}}),j=()=>{B(),m(null),x==null||x()};return c.useEffect(()=>{},[]),e.jsx(he,{...S,children:e.jsx(ne,{open:f,onClose:j,children:e.jsx(je,{children:e.jsxs("form",{onSubmit:z,children:[e.jsxs(Q,{children:[e.jsx(E,{variant:"h6",children:"Đăng tải"}),e.jsx(te,{onClick:j,sx:{cursor:"pointer"}})]}),e.jsxs(v,{flexDirection:"column",gap:4,marginY:2,children:[e.jsx(R,{label:"Tiêu đề",registerProps:d("title"),errorMsg:(V=p.title)==null?void 0:V.message}),e.jsx(G,{label:"Tên lớp học",registerProps:d("classId"),errorMsg:(W=p.classId)==null?void 0:W.message,selectOptions:O,disabled:!!t.id}),e.jsx(G,{label:"Tên môn học",registerProps:d("subjectId"),errorMsg:(_=p.subjectId)==null?void 0:_.message,selectOptions:s,disabled:!!t.id}),e.jsx(R,{label:"Tên tác giả",registerProps:d("author"),errorMsg:(X=p.author)==null?void 0:X.message}),e.jsxs(v,{flexDirection:"column",children:[e.jsxs(k,{variant:"outlined",component:"label",sx:{textTransform:"none"},children:["Chọn file từ máy tính",e.jsx("input",{hidden:!0,accept:"application/pdf",type:"file",...d("file",{onChange:i=>{var g;const o=((g=i.target.files)==null?void 0:g[0])||null;D("file",o,{shouldValidate:!0}),D("title",o?o.name.split(".")[0]:""),m(o.name)}})})]}),(u||C)&&e.jsx(E,{variant:"body2",color:"text.secondary",sx:{marginTop:1},children:u||C}),e.jsx(ge,{message:(Y=p.file)==null?void 0:Y.message})]})]}),e.jsxs(be,{marginTop:4,gap:2,children:[e.jsx(k,{onClick:j,children:"Huỷ bỏ"}),e.jsx(k,{variant:"contained",type:"submit",disabled:$||se,onClick:z,children:"Lưu"})]})]})})})})},Re=()=>{const{user:n}=Ee(),{subjectId:f,setSelectedDocument:x}=H(),[T,w]=c.useState({}),[P,a]=c.useState(!1),[t,u]=c.useState(!1),[C,m]=c.useState(0),{register:S,handleSubmit:d}=J({}),I=d(s=>{w(s)}),{data:l}=fe({...T,subjectId:f||void 0}),{mutate:D}=K(),{mutate:B}=Ce(),p=s=>{window.open(s,"_blank")},A=s=>{B(s,{onSuccess(){u(!1)}})},O=s=>{D({documentId:s.id,payload:{...s,views:s.views+1}})};return e.jsx(Me,{children:e.jsxs("form",{onSubmit:I,children:[e.jsxs(F,{padding:2,children:[e.jsxs(Q,{children:[e.jsx(F,{children:e.jsx(E,{variant:"h6",marginTop:2,sx:{display:{xs:"none",sm:"block"}},children:"TÀI LIỆU NỔI BẬT"})}),e.jsxs(b,{gap:2,children:[n.role===U.RoleAdmin&&e.jsxs(e.Fragment,{children:[e.jsx(k,{variant:"contained",sx:{display:{xs:"none",md:"block"}},onClick:()=>a(!0),children:"Đăng tải"}),e.jsx(ie,{fontSize:"large",sx:{cursor:"pointer",display:{xs:"block",md:"none"}},onClick:()=>a(!0)})]}),e.jsxs(b,{gap:2,children:[e.jsx(R,{label:"Tìm kiếm theo tiêu đề",registerProps:S("title"),showLabel:!1}),e.jsx(oe,{onClick:I,sx:{cursor:"pointer",width:32,height:32}})]})]})]}),e.jsx(Se,{children:l==null?void 0:l.map(s=>e.jsx(Ie,{onClick:()=>{m(s.id),O(s),p(s.fileUrl)},children:e.jsxs(ae,{children:[e.jsxs(F,{paddingX:2,sx:{position:"relative"},children:[e.jsx(N,{variant:"h6",lines:2,sx:{fontWeight:"bold",color:De,height:64,paddingRight:5},children:s.title}),n.role===U.RoleAdmin&&e.jsx(Ae,{onClick:h=>{h.stopPropagation(),m(s.id),u(!0)}}),n.role===U.RoleAdmin&&e.jsx(ye,{onClick:h=>{h.stopPropagation(),x(s),a(!0),m(s.id)}}),e.jsxs(b,{marginTop:1,gap:1,children:[e.jsx(le,{sx:{fontSize:26}}),e.jsx(N,{sx:{textAlign:"center"},children:s.category})]})]}),e.jsx(re,{sx:{paddingY:2}}),e.jsxs(F,{paddingX:2,children:[e.jsxs(b,{justifyContent:"space-between",marginTop:4,children:[e.jsxs(v,{gap:1,children:[e.jsx(ce,{}),e.jsx(E,{children:s.views})]}),e.jsxs(v,{gap:1,children:[e.jsx(ue,{}),e.jsx(E,{children:s.downloads})]})]}),e.jsxs(b,{marginTop:1,gap:1,children:[e.jsx(de,{}),e.jsxs(N,{lines:1,children:["Tác giả: ",s.author]})]})]})]})},s.id))}),e.jsx(ke,{length:(l==null?void 0:l.length)||0})]}),e.jsx(Te,{open:P,onClose:()=>a(!1)}),e.jsx(Fe,{open:t,onClose:()=>u(!1),content:"Bạn có chắc chắn muốn xoá nó không?",onSubmit:()=>A(C)})]})})};export{Re as default};
