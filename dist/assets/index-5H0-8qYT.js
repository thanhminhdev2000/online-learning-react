import{r as u,j as e,aj as Y,T as S,ak as $,S as f,f as v,B as b,ax as q,ay as J}from"./vendor-mui-DDhzcgPb.js";import{u as Q,c as Z,a as _,b as ee,d as se,e as te}from"./type-C0sLYKY_.js";import{d as X,u as z,t as ne,F as ie,M as re,S as K,C as E,i as H,w as ae,E as oe,j as le,k as ce,I as ue,U as B,n as de,L as pe,x as he,y as me,O as V,D as xe,s as ge,v as je}from"./index-Bm6skYEt.js";import{C as Ce}from"./ClassMenu-B9UyJvPF.js";import{N as be}from"./index-BVLnVObh.js";import{u as Ee}from"./vendor-router-B6q9Nvgf.js";import"./vendor-utils-BRiujrGV.js";const Se=({open:F,onClose:l})=>{var O,N,L,w,R,G,U;const{classId:I,subjectId:k,classes:d,selectedCourse:t}=X(),[c,M]=u.useState(),p=z({resolver:ne(t.id?Q:Z),values:{title:t.title,classId:t.classId||I,subjectId:t.subjectId||k,instructor:t.instructor,price:t.id?String(t.price):"",description:t.description,thumbnail:void 0}}),{register:r,handleSubmit:m,watch:y,setValue:D,reset:o,formState:{errors:n}}=p,x=y("classId"),P=u.useMemo(()=>d.map(h=>({key:h.name,value:h.id})),[d]),T=u.useMemo(()=>{var C,W;return(W=((C=d.find(A=>A.id===x))==null?void 0:C.subjects)||[])==null?void 0:W.map(A=>({key:A.name,value:A.id}))},[x,d]),g=_(),j=ee(),s=m(i=>{if(t.id){j.mutate({id:t.id,data:{...i,price:Number(i.price)}},{onSuccess(){a()}});return}i.thumbnail&&g.mutate({...i,price:Number(i.price),thumbnail:i.thumbnail},{onSuccess(){a()}})}),a=()=>{o(),M(null),l==null||l()};return e.jsx(ie,{...p,children:e.jsx(Y,{open:F,onClose:a,children:e.jsx(re,{children:e.jsxs("form",{onSubmit:s,children:[e.jsxs(K,{children:[e.jsx(S,{variant:"h6",children:"Đăng tải tài liệu"}),e.jsx($,{onClick:a,sx:{cursor:"pointer"}})]}),e.jsxs(f,{flexDirection:"column",gap:4,marginY:2,children:[e.jsx(E,{label:"Tiêu đề",registerProps:r("title"),errorMsg:(O=n.title)==null?void 0:O.message}),e.jsx(H,{label:"Tên lớp học",registerProps:r("classId"),errorMsg:(N=n.classId)==null?void 0:N.message,selectOptions:P,disabled:!!t.id}),e.jsx(H,{label:"Tên môn học",registerProps:r("subjectId"),errorMsg:(L=n.subjectId)==null?void 0:L.message,selectOptions:T,disabled:!!t.id}),e.jsx(E,{label:"Giá bán",registerProps:r("price"),errorMsg:(w=n.price)==null?void 0:w.message}),e.jsx(E,{label:"Mô tả",registerProps:r("description"),errorMsg:(R=n.description)==null?void 0:R.message,multiline:!0}),e.jsx(E,{label:"Giáo viên",registerProps:r("instructor"),errorMsg:(G=n.instructor)==null?void 0:G.message}),e.jsxs(f,{flexDirection:"column",children:[e.jsx(ae,{children:"Ảnh bìa"}),e.jsxs(v,{variant:"outlined",component:"label",sx:{textTransform:"none"},children:["Chọn file từ máy tính",e.jsx("input",{hidden:!0,accept:"image/jpeg,image/png,image/gif",type:"file",...r("thumbnail",{onChange:i=>{var C;const h=((C=i.target.files)==null?void 0:C[0])||null;D("thumbnail",h,{shouldValidate:!0}),M(h.name)}})})]}),c&&e.jsx(S,{variant:"body2",color:"text.secondary",sx:{marginTop:1},children:c}),e.jsx(oe,{message:(U=n.thumbnail)==null?void 0:U.message})]})]}),e.jsxs(le,{marginTop:4,gap:2,children:[e.jsx(v,{onClick:a,children:"Huỷ bỏ"}),e.jsx(v,{variant:"contained",type:"submit",disabled:g.isPending||j.isPending,onClick:s,children:"Lưu"})]})]})})})})},ye=()=>{var g,j;const F=Ee(),{user:l}=ce(),{setSelectedCourse:I}=X(),[k,d]=u.useState(""),[t,c]=u.useState(!1),[M,p]=u.useState(!1),[r,m]=u.useState(0),{register:y,handleSubmit:D}=z({values:{search:""}}),{data:o,isFetching:n}=se({search:k}),x=D(s=>{d(s.search)}),{mutate:P}=te(),T=s=>{P(s,{onSuccess(){p(!1)}})};return e.jsx(Ce,{children:e.jsxs("form",{onSubmit:x,children:[e.jsxs(b,{padding:2,children:[e.jsxs(K,{children:[e.jsx(b,{children:e.jsx(S,{variant:"h6",marginTop:2,sx:{display:{xs:"none",sm:"block"}},children:"KHOÁ HỌC NỔI BẬT"})}),e.jsxs(ue,{gap:2,children:[l.role===B.RoleAdmin&&e.jsxs(e.Fragment,{children:[e.jsx(v,{variant:"contained",sx:{display:{xs:"none",md:"block"}},onClick:()=>c(!0),children:"Đăng tải"}),e.jsx(q,{fontSize:"large",sx:{cursor:"pointer",display:{xs:"block",md:"none"}},onClick:()=>c(!0)})]}),e.jsxs(de,{gap:2,children:[e.jsx(E,{label:"Tìm kiếm theo tiêu đề",registerProps:y("search"),showLabel:!1}),e.jsx(J,{onClick:x,sx:{cursor:"pointer",width:32,height:32}})]})]})]}),n?e.jsx(pe,{isFullScreen:!1}):e.jsx(be,{length:((g=o==null?void 0:o.data)==null?void 0:g.length)||0}),e.jsx(he,{children:!n&&((j=o==null?void 0:o.data)==null?void 0:j.map(s=>e.jsx(b,{onClick:()=>{console.log(s.id),F(`/courses/${s.id}`),m(s.id)},children:e.jsxs(b,{sx:{position:"relative",border:"1px solid #ccc",cursor:"pointer",paddingBottom:5},children:[e.jsx(me,{src:s.thumbnailUrl,alt:"Ảnh bìa"}),e.jsxs(f,{flexDirection:"column",gap:2,paddingX:3,height:200,children:[e.jsx(V,{variant:"h6",lines:2,sx:{fontWeight:"bold",height:64,paddingRight:5},children:s.title}),e.jsx(V,{lines:3,children:s==null?void 0:s.description}),e.jsxs(f,{gap:1,children:["Giáo viên: ",e.jsx(S,{fontWeight:"bold",children:s.instructor})]}),e.jsxs(f,{gap:1,children:["Giá: ",e.jsxs(S,{fontWeight:"bold",children:[s.price.toLocaleString()," VND"]})]})]}),e.jsxs(b,{paddingX:2,children:[l.role===B.RoleAdmin&&e.jsx(xe,{onClick:a=>{a.stopPropagation(),m(s.id),p(!0)}}),l.role===B.RoleAdmin&&e.jsx(ge,{onClick:a=>{a.stopPropagation(),I(s),c(!0),m(s.id)}})]})]})},s.id)))})]}),e.jsx(Se,{open:t,onClose:()=>{I({}),c(!1)}}),e.jsx(je,{open:M,onClose:()=>p(!1),content:"Bạn có chắc chắn muốn xoá nó không?",onSubmit:()=>T(r)})]})})};export{ye as default};
