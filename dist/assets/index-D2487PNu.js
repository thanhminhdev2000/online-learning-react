import{v as z,r as c,j as e,M as K,y as Q,z as X,T as E,S,R as Y,c as F,F as $,u as q,a as Z,B as C,I as _,J as B,G as ee,V as se,W as te,O as H,P as ne,Q as ie}from"./index-BnQnY9EU.js";import{u as re,c as ae,a as oe,b as le,d as ce,e as ue}from"./type-D76zXet1.js";import{C as de,a as pe}from"./index-n6AzoaaD.js";import{u as J,t as he,F as me,C as b,E as xe}from"./index-DBvPQqYV.js";import{C as ge,A as je,S as Ce}from"./ClassMenu-BZX8Nq2X.js";import{N as be}from"./index-BM94K5iA.js";import{C as U}from"./index-J26dzwcw.js";const Ee=({open:k,onClose:o})=>{var O,N,R,G,w,L,W;const{classId:f,subjectId:y,classes:u,selectedCourse:t}=z(),[l,A]=c.useState(),d=J({resolver:he(t.id?re:ae),values:{title:t.title,classId:t.classId||f,subjectId:t.subjectId||y,instructor:t.instructor,price:t.id?String(t.price):"",description:t.description,thumbnail:void 0}}),{register:r,handleSubmit:m,watch:D,setValue:P,reset:a,formState:{errors:n}}=d,I=D("classId"),T=c.useMemo(()=>u.map(h=>({key:h.name,value:h.id})),[u]),M=c.useMemo(()=>{var j,V;return(V=((j=u.find(v=>v.id===I))==null?void 0:j.subjects)||[])==null?void 0:V.map(v=>({key:v.name,value:v.id}))},[I,u]),x=oe(),s=le(),p=m(i=>{if(t.id){s.mutate({id:t.id,data:{...i,price:Number(i.price)}},{onSuccess(){g()}});return}i.thumbnail&&x.mutate({...i,price:Number(i.price),thumbnail:i.thumbnail},{onSuccess(){g()}})}),g=()=>{a(),A(null),o==null||o()};return e.jsx(me,{...d,children:e.jsx(K,{open:k,onClose:g,children:e.jsx(Q,{children:e.jsxs("form",{onSubmit:p,children:[e.jsxs(X,{children:[e.jsx(E,{variant:"h6",children:"Đăng tải tài liệu"}),e.jsx(de,{onClick:g,sx:{cursor:"pointer"}})]}),e.jsxs(S,{flexDirection:"column",gap:4,marginY:2,children:[e.jsx(b,{label:"Tiêu đề",registerProps:r("title"),errorMsg:(O=n.title)==null?void 0:O.message}),e.jsx(U,{label:"Tên lớp học",registerProps:r("classId"),errorMsg:(N=n.classId)==null?void 0:N.message,selectOptions:T,disabled:!!t.id}),e.jsx(U,{label:"Tên môn học",registerProps:r("subjectId"),errorMsg:(R=n.subjectId)==null?void 0:R.message,selectOptions:M,disabled:!!t.id}),e.jsx(b,{label:"Giá bán",registerProps:r("price"),errorMsg:(G=n.price)==null?void 0:G.message}),e.jsx(b,{label:"Mô tả",registerProps:r("description"),errorMsg:(w=n.description)==null?void 0:w.message,multiline:!0}),e.jsx(b,{label:"Giáo viên",registerProps:r("instructor"),errorMsg:(L=n.instructor)==null?void 0:L.message}),e.jsxs(S,{flexDirection:"column",children:[e.jsx(Y,{children:"Ảnh bìa"}),e.jsxs(F,{variant:"outlined",component:"label",sx:{textTransform:"none"},children:["Chọn file từ máy tính",e.jsx("input",{hidden:!0,accept:"image/jpeg,image/png,image/gif",type:"file",...r("thumbnail",{onChange:i=>{var j;const h=((j=i.target.files)==null?void 0:j[0])||null;P("thumbnail",h,{shouldValidate:!0}),A(h.name)}})})]}),l&&e.jsx(E,{variant:"body2",color:"text.secondary",sx:{marginTop:1},children:l}),e.jsx(xe,{message:(W=n.thumbnail)==null?void 0:W.message})]})]}),e.jsxs($,{marginTop:4,gap:2,children:[e.jsx(F,{onClick:g,children:"Huỷ bỏ"}),e.jsx(F,{variant:"contained",type:"submit",disabled:x.isPending||s.isPending,onClick:p,children:"Lưu"})]})]})})})})},ke=()=>{var M,x;const k=q(),{user:o}=Z(),{setSelectedCourse:f}=z(),[y,u]=c.useState(""),[t,l]=c.useState(!1),[A,d]=c.useState(!1),[r,m]=c.useState(0),{register:D,handleSubmit:P}=J({values:{search:""}}),{data:a}=ce({search:y}),n=P(s=>{u(s.search)}),{mutate:I}=ue(),T=s=>{I(s,{onSuccess(){d(!1)}})};return e.jsx(ge,{children:e.jsxs("form",{onSubmit:n,children:[e.jsxs(C,{padding:2,children:[e.jsxs(X,{children:[e.jsx(C,{children:e.jsx(E,{variant:"h6",marginTop:2,sx:{display:{xs:"none",sm:"block"}},children:"KHOÁ HỌC NỔI BẬT"})}),e.jsxs(_,{gap:2,children:[o.role===B.RoleAdmin&&e.jsxs(e.Fragment,{children:[e.jsx(F,{variant:"contained",sx:{display:{xs:"none",md:"block"}},onClick:()=>l(!0),children:"Đăng tải"}),e.jsx(je,{fontSize:"large",sx:{cursor:"pointer",display:{xs:"block",md:"none"}},onClick:()=>l(!0)})]}),e.jsxs(ee,{gap:2,children:[e.jsx(b,{label:"Tìm kiếm theo tiêu đề",registerProps:D("search"),showLabel:!1}),e.jsx(Ce,{onClick:n,sx:{cursor:"pointer",width:32,height:32}})]})]})]}),e.jsx(se,{children:(M=a==null?void 0:a.data)==null?void 0:M.map(s=>e.jsx(C,{onClick:()=>{console.log(s.id),k(`/courses/${s.id}`),m(s.id)},children:e.jsxs(C,{sx:{position:"relative",border:"1px solid #ccc",cursor:"pointer",paddingBottom:5},children:[e.jsx(te,{src:s.thumbnailUrl,alt:"Ảnh bìa"}),e.jsxs(S,{flexDirection:"column",gap:2,paddingX:3,height:200,children:[e.jsx(H,{variant:"h6",lines:2,sx:{fontWeight:"bold",height:64,paddingRight:5},children:s.title}),e.jsx(H,{lines:3,children:s==null?void 0:s.description}),e.jsxs(S,{gap:1,children:["Giáo viên: ",e.jsx(E,{fontWeight:"bold",children:s.instructor})]}),e.jsxs(S,{gap:1,children:["Giá: ",e.jsxs(E,{fontWeight:"bold",children:[s.price.toLocaleString()," VND"]})]})]}),e.jsxs(C,{paddingX:2,children:[o.role===B.RoleAdmin&&e.jsx(ne,{onClick:p=>{p.stopPropagation(),m(s.id),d(!0)}}),o.role===B.RoleAdmin&&e.jsx(ie,{onClick:p=>{p.stopPropagation(),f(s),l(!0),m(s.id)}})]})]})},s.id))}),e.jsx(be,{length:((x=a==null?void 0:a.data)==null?void 0:x.length)||0})]}),e.jsx(Ee,{open:t,onClose:()=>{f({}),l(!1)}}),e.jsx(pe,{open:A,onClose:()=>d(!1),content:"Bạn có chắc chắn muốn xoá nó không?",onSubmit:()=>T(r)})]})})};export{ke as default};
