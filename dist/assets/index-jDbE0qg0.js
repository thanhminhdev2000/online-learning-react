import{r as c,j as e,aj as Y,T as E,ak as $,S,f as k,B as C,ax as q,ay as J}from"./vendor-mui-DDhzcgPb.js";import{u as Q,c as Z,a as _,b as ee,d as se,e as te}from"./type-f6INFkbl.js";import{d as X,u as z,t as ne,F as ie,M as re,S as K,C as b,i as H,w as ae,E as oe,j as le,k as ce,I as ue,U as B,n as de,x as pe,y as he,O as V,D as me,s as xe,v as ge}from"./index-BnGCAzKI.js";import{C as je}from"./ClassMenu-BOt6unAO.js";import{N as Ce}from"./index-COobKTZ7.js";import{u as be}from"./vendor-router-B6q9Nvgf.js";import"./vendor-utils-BRiujrGV.js";const Ee=({open:F,onClose:o})=>{var O,N,w,R,G,L,U;const{classId:f,subjectId:y,classes:u,selectedCourse:t}=X(),[l,I]=c.useState(),d=z({resolver:ne(t.id?Q:Z),values:{title:t.title,classId:t.classId||f,subjectId:t.subjectId||y,instructor:t.instructor,price:t.id?String(t.price):"",description:t.description,thumbnail:void 0}}),{register:r,handleSubmit:m,watch:D,setValue:P,reset:a,formState:{errors:n}}=d,M=D("classId"),T=c.useMemo(()=>u.map(h=>({key:h.name,value:h.id})),[u]),A=c.useMemo(()=>{var j,W;return(W=((j=u.find(v=>v.id===M))==null?void 0:j.subjects)||[])==null?void 0:W.map(v=>({key:v.name,value:v.id}))},[M,u]),x=_(),s=ee(),p=m(i=>{if(t.id){s.mutate({id:t.id,data:{...i,price:Number(i.price)}},{onSuccess(){g()}});return}i.thumbnail&&x.mutate({...i,price:Number(i.price),thumbnail:i.thumbnail},{onSuccess(){g()}})}),g=()=>{a(),I(null),o==null||o()};return e.jsx(ie,{...d,children:e.jsx(Y,{open:F,onClose:g,children:e.jsx(re,{children:e.jsxs("form",{onSubmit:p,children:[e.jsxs(K,{children:[e.jsx(E,{variant:"h6",children:"Đăng tải tài liệu"}),e.jsx($,{onClick:g,sx:{cursor:"pointer"}})]}),e.jsxs(S,{flexDirection:"column",gap:4,marginY:2,children:[e.jsx(b,{label:"Tiêu đề",registerProps:r("title"),errorMsg:(O=n.title)==null?void 0:O.message}),e.jsx(H,{label:"Tên lớp học",registerProps:r("classId"),errorMsg:(N=n.classId)==null?void 0:N.message,selectOptions:T,disabled:!!t.id}),e.jsx(H,{label:"Tên môn học",registerProps:r("subjectId"),errorMsg:(w=n.subjectId)==null?void 0:w.message,selectOptions:A,disabled:!!t.id}),e.jsx(b,{label:"Giá bán",registerProps:r("price"),errorMsg:(R=n.price)==null?void 0:R.message}),e.jsx(b,{label:"Mô tả",registerProps:r("description"),errorMsg:(G=n.description)==null?void 0:G.message,multiline:!0}),e.jsx(b,{label:"Giáo viên",registerProps:r("instructor"),errorMsg:(L=n.instructor)==null?void 0:L.message}),e.jsxs(S,{flexDirection:"column",children:[e.jsx(ae,{children:"Ảnh bìa"}),e.jsxs(k,{variant:"outlined",component:"label",sx:{textTransform:"none"},children:["Chọn file từ máy tính",e.jsx("input",{hidden:!0,accept:"image/jpeg,image/png,image/gif",type:"file",...r("thumbnail",{onChange:i=>{var j;const h=((j=i.target.files)==null?void 0:j[0])||null;P("thumbnail",h,{shouldValidate:!0}),I(h.name)}})})]}),l&&e.jsx(E,{variant:"body2",color:"text.secondary",sx:{marginTop:1},children:l}),e.jsx(oe,{message:(U=n.thumbnail)==null?void 0:U.message})]})]}),e.jsxs(le,{marginTop:4,gap:2,children:[e.jsx(k,{onClick:g,children:"Huỷ bỏ"}),e.jsx(k,{variant:"contained",type:"submit",disabled:x.isPending||s.isPending,onClick:p,children:"Lưu"})]})]})})})})},Fe=()=>{var A,x;const F=be(),{user:o}=ce(),{setSelectedCourse:f}=X(),[y,u]=c.useState(""),[t,l]=c.useState(!1),[I,d]=c.useState(!1),[r,m]=c.useState(0),{register:D,handleSubmit:P}=z({values:{search:""}}),{data:a}=se({search:y}),n=P(s=>{u(s.search)}),{mutate:M}=te(),T=s=>{M(s,{onSuccess(){d(!1)}})};return e.jsx(je,{children:e.jsxs("form",{onSubmit:n,children:[e.jsxs(C,{padding:2,children:[e.jsxs(K,{children:[e.jsx(C,{children:e.jsx(E,{variant:"h6",marginTop:2,sx:{display:{xs:"none",sm:"block"}},children:"KHOÁ HỌC NỔI BẬT"})}),e.jsxs(ue,{gap:2,children:[o.role===B.RoleAdmin&&e.jsxs(e.Fragment,{children:[e.jsx(k,{variant:"contained",sx:{display:{xs:"none",md:"block"}},onClick:()=>l(!0),children:"Đăng tải"}),e.jsx(q,{fontSize:"large",sx:{cursor:"pointer",display:{xs:"block",md:"none"}},onClick:()=>l(!0)})]}),e.jsxs(de,{gap:2,children:[e.jsx(b,{label:"Tìm kiếm theo tiêu đề",registerProps:D("search"),showLabel:!1}),e.jsx(J,{onClick:n,sx:{cursor:"pointer",width:32,height:32}})]})]})]}),e.jsx(pe,{children:(A=a==null?void 0:a.data)==null?void 0:A.map(s=>e.jsx(C,{onClick:()=>{console.log(s.id),F(`/courses/${s.id}`),m(s.id)},children:e.jsxs(C,{sx:{position:"relative",border:"1px solid #ccc",cursor:"pointer",paddingBottom:5},children:[e.jsx(he,{src:s.thumbnailUrl,alt:"Ảnh bìa"}),e.jsxs(S,{flexDirection:"column",gap:2,paddingX:3,height:200,children:[e.jsx(V,{variant:"h6",lines:2,sx:{fontWeight:"bold",height:64,paddingRight:5},children:s.title}),e.jsx(V,{lines:3,children:s==null?void 0:s.description}),e.jsxs(S,{gap:1,children:["Giáo viên: ",e.jsx(E,{fontWeight:"bold",children:s.instructor})]}),e.jsxs(S,{gap:1,children:["Giá: ",e.jsxs(E,{fontWeight:"bold",children:[s.price.toLocaleString()," VND"]})]})]}),e.jsxs(C,{paddingX:2,children:[o.role===B.RoleAdmin&&e.jsx(me,{onClick:p=>{p.stopPropagation(),m(s.id),d(!0)}}),o.role===B.RoleAdmin&&e.jsx(xe,{onClick:p=>{p.stopPropagation(),f(s),l(!0),m(s.id)}})]})]})},s.id))}),e.jsx(Ce,{length:((x=a==null?void 0:a.data)==null?void 0:x.length)||0})]}),e.jsx(Ee,{open:t,onClose:()=>{f({}),l(!1)}}),e.jsx(ge,{open:I,onClose:()=>d(!1),content:"Bạn có chắc chắn muốn xoá nó không?",onSubmit:()=>T(r)})]})})};export{Fe as default};
