import{l as ne,m as oe,s as ie,r as c,n as ae,j as e,o as le,p as re,q as B,t as w,v as J,w as ce,x as K,h as de,M as ue,y as pe,z as Q,T as I,S as P,c as k,F as me,a as xe,C as he,E as je,B as T,G as S,J as N,K as ge,L as Ce,O,N as be,P as fe,Q as Ee}from"./index-ZjgjDmZy.js";import{C as Se,a as Ie}from"./index-CGZMWKPh.js";import{z as p,u as Z,t as De,F as Me,C as z,E as ve}from"./index-IKM86iON.js";import{C as ye,A as Ae,S as Fe}from"./ClassMenu-BUlDrYxO.js";import{N as we}from"./index-BSNxzW1E.js";import{C as q}from"./index-CTJiQCMs.js";import{D as Te}from"./Divider-B65so1e0.js";function ke(t){return oe("MuiCardContent",t)}ne("MuiCardContent",["root"]);const Pe=t=>{const{classes:a}=t;return re({root:["root"]},ke,a)},Be=ie("div",{name:"MuiCardContent",slot:"Root",overridesResolver:(t,a)=>a.root})({padding:16,"&:last-child":{paddingBottom:24}}),Re=c.forwardRef(function(a,d){const h=ae({props:a,name:"MuiCardContent"}),{className:C,component:j="div",...i}=h,n={...h,component:j},r=Pe(n);return e.jsx(Be,{as:j,className:le(r.root,C),ownerState:n,ref:d,...i})}),Ue=B(e.jsx("path",{d:"M5 20h14v-2H5zM19 9h-4V3H9v6H5l7 7z"}),"Download"),Ne=B(e.jsx("path",{d:"M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8z"}),"Folder"),Oe=B(e.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"Person"),ze=B(e.jsx("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"}),"Visibility"),$=p.object({title:p.string().min(1,w("Tiêu đề")),classId:p.number().min(1,w("Tên lớp học")),subjectId:p.number().min(1,w("Tên môn học")),author:p.string(),file:p.any().refine(t=>t instanceof File&&t.size>0,w("File"))}),Le=$.omit({file:!0}).merge(p.object({file:p.any().optional()})),Ve=({refetch:t,open:a,onClose:d})=>{var V,H,W,_,G,X;const h="https://online-learning-aws.s3.us-east-1.amazonaws.com/pdfs/",{classId:C,subjectId:j,classes:i,selectedDocument:n}=J(),r=(V=n.fileUrl)==null?void 0:V.split(h)[1],[D,g]=c.useState(r),M=Z({resolver:De(n.id?Le:$),values:{title:n.title||"",classId:n.classId||C,subjectId:n.subjectId||j,author:n.author,file:void 0}}),{register:m,handleSubmit:v,watch:u,setValue:y,reset:R,formState:{errors:x}}=M,A=u("classId"),U=c.useMemo(()=>i.map(l=>({key:l.name,value:l.id})),[i]),s=c.useMemo(()=>{var E,Y;return(Y=((E=i.find(F=>F.id===A))==null?void 0:E.subjects)||[])==null?void 0:Y.map(F=>({key:F.name,value:F.id}))},[A,i]),{mutate:b,isPending:ee}=ce(),{mutate:se,isPending:te}=K(),L=v(o=>{if(o.file){if(n.id){se({documentId:n.id,payload:{title:o.title,file:o.file,author:o.author}},{onSuccess(l){f(),t==null||t(),de.success(l.message)}});return}b({title:o.title,subjectId:Number(o.subjectId),file:o.file,author:o.author},{onSuccess(){f(),t==null||t()}})}}),f=()=>{R(),g(null),d==null||d()};return c.useEffect(()=>{},[]),e.jsx(Me,{...M,children:e.jsx(ue,{open:a,onClose:f,children:e.jsx(pe,{children:e.jsxs("form",{onSubmit:L,children:[e.jsxs(Q,{children:[e.jsx(I,{variant:"h6",children:"Đăng tải"}),e.jsx(Se,{onClick:f,sx:{cursor:"pointer"}})]}),e.jsxs(P,{flexDirection:"column",gap:4,marginY:2,children:[e.jsx(z,{label:"Tiêu đề",registerProps:m("title"),errorMsg:(H=x.title)==null?void 0:H.message}),e.jsx(q,{label:"Tên lớp học",registerProps:m("classId"),errorMsg:(W=x.classId)==null?void 0:W.message,selectOptions:U,disabled:!!n.id}),e.jsx(q,{label:"Tên môn học",registerProps:m("subjectId"),errorMsg:(_=x.subjectId)==null?void 0:_.message,selectOptions:s,disabled:!!n.id}),e.jsx(z,{label:"Tên tác giả",registerProps:m("author"),errorMsg:(G=x.author)==null?void 0:G.message}),e.jsxs(P,{flexDirection:"column",children:[e.jsxs(k,{variant:"outlined",component:"label",sx:{textTransform:"none"},children:["Chọn file từ máy tính",e.jsx("input",{hidden:!0,accept:"application/pdf",type:"file",...m("file",{onChange:o=>{var E;const l=((E=o.target.files)==null?void 0:E[0])||null;y("file",l,{shouldValidate:!0}),y("title",l?l.name.split(".")[0]:""),g(l.name)}})})]}),(r||D)&&e.jsx(I,{variant:"body2",color:"text.secondary",sx:{marginTop:1},children:r||D}),e.jsx(ve,{message:(X=x.file)==null?void 0:X.message})]})]}),e.jsxs(me,{marginTop:4,gap:2,children:[e.jsx(k,{onClick:f,children:"Huỷ bỏ"}),e.jsx(k,{variant:"contained",type:"submit",disabled:ee||te,onClick:L,children:"Lưu"})]})]})})})})},Je=()=>{const{user:t}=xe(),{subjectId:a,setSelectedDocument:d}=J(),[h,C]=c.useState({}),[j,i]=c.useState(!1),[n,r]=c.useState(!1),[D,g]=c.useState(0),{register:M,handleSubmit:m}=Z({}),v=m(s=>{C(s)}),{data:u}=he({...h,subjectId:a||void 0}),{mutate:y}=K(),{mutate:R}=je(),x=s=>{window.open(s,"_blank")},A=s=>{R(s,{onSuccess(){r(!1)}})},U=s=>{y({documentId:s.id,payload:{...s,views:s.views+1}})};return e.jsx(ye,{children:e.jsxs("form",{onSubmit:v,children:[e.jsxs(T,{padding:2,children:[e.jsxs(Q,{children:[e.jsx(T,{children:e.jsx(I,{variant:"h6",marginTop:2,sx:{display:{xs:"none",sm:"block"}},children:"TÀI LIỆU NỔI BẬT"})}),e.jsxs(S,{gap:2,children:[t.role===N.RoleAdmin&&e.jsxs(e.Fragment,{children:[e.jsx(k,{variant:"contained",sx:{display:{xs:"none",md:"block"}},onClick:()=>i(!0),children:"Đăng tải"}),e.jsx(Ae,{fontSize:"large",sx:{cursor:"pointer",display:{xs:"block",md:"none"}},onClick:()=>i(!0)})]}),e.jsxs(S,{gap:2,children:[e.jsx(z,{label:"Tìm kiếm theo tiêu đề",registerProps:M("title"),showLabel:!1}),e.jsx(Fe,{onClick:v,sx:{cursor:"pointer",width:32,height:32}})]})]})]}),e.jsx(ge,{children:u==null?void 0:u.map(s=>e.jsx(Ce,{onClick:()=>{g(s.id),U(s),x(s.fileUrl)},children:e.jsxs(Re,{children:[e.jsxs(T,{paddingX:2,sx:{position:"relative"},children:[e.jsx(O,{variant:"h6",lines:2,sx:{fontWeight:"bold",color:be,height:64,paddingRight:5},children:s.title}),t.role===N.RoleAdmin&&e.jsx(fe,{onClick:b=>{b.stopPropagation(),g(s.id),r(!0)}}),t.role===N.RoleAdmin&&e.jsx(Ee,{onClick:b=>{b.stopPropagation(),d(s),i(!0),g(s.id)}}),e.jsxs(S,{marginTop:1,gap:1,children:[e.jsx(Ne,{sx:{fontSize:26}}),e.jsx(O,{sx:{textAlign:"center"},children:s.category})]})]}),e.jsx(Te,{sx:{paddingY:2}}),e.jsxs(T,{paddingX:2,children:[e.jsxs(S,{justifyContent:"space-between",marginTop:4,children:[e.jsxs(P,{gap:1,children:[e.jsx(ze,{}),e.jsx(I,{children:s.views})]}),e.jsxs(P,{gap:1,children:[e.jsx(Ue,{}),e.jsx(I,{children:s.downloads})]})]}),e.jsxs(S,{marginTop:1,gap:1,children:[e.jsx(Oe,{}),e.jsxs(O,{lines:1,children:["Tác giả: ",s.author]})]})]})]})},s.id))}),e.jsx(we,{length:(u==null?void 0:u.length)||0})]}),e.jsx(Ve,{open:j,onClose:()=>i(!1)}),e.jsx(Ie,{open:n,onClose:()=>r(!1),content:"Bạn có chắc chắn muốn xoá nó không?",onSubmit:()=>A(D)})]})})};export{Je as default};
